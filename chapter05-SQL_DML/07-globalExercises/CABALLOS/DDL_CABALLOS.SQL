-- Adrián Navarro Gabino


-- DROP TABLE PARTICIPACIONES;

-- DROP TABLE APUESTAS;

-- DROP TABLE CLIENTES;

-- DROP TABLE CABALLOS;

-- DROP TABLE CARRERAS;


CREATE TABLE CABALLOS (
    CODCABALLO VARCHAR2(4) NOT NULL,
    NOMBRE VARCHAR2(20) NOT NULL,
    PESO NUMBER(3) CHECK(PESO BETWEEN 240 AND 300),
    FECHANACIMIENTO DATE CHECK(TO_CHAR(FECHANACIMIENTO, 'YYYY') > 2000),
    PROPIETARIO VARCHAR2(25),
    NACIONALIDAD VARCHAR2(20),
      CONSTRAINT PK_CABALLOS PRIMARY KEY (CODCABALLO)
);

CREATE TABLE CARRERAS (
    CODCARRERA VARCHAR2(4) NOT NULL,
    FECHAHORA DATE CHECK(TO_CHAR(FECHAHORA, 'HHMM') BETWEEN 0900 AND 1430),
    NOMBRE VARCHAR2(20),
    IMPORTEPREMIO NUMBER(6),
    APUESTALIMITE NUMBER(7,2) CHECK(APUESTALIMITE < 20000),
      CONSTRAINT PK_CARRERAS PRIMARY KEY (CODCARRERA)
);

CREATE TABLE PARTICIPACIONES (
    CODCABALLO VARCHAR2(4) NOT NULL,
    CODCARRERA VARCHAR2(4) NOT NULL,
    DORSAL NUMBER(2) NOT NULL,
    JOCKEY VARCHAR2(20) NOT NULL,
    POSICIONFINAL NUMBER(2) CHECK(POSICIONFINAL > 0),
      CONSTRAINT PK_PARTICIPACIONES PRIMARY KEY (CODCABALLO, CODCARRERA),
      CONSTRAINT FK_PARTICIPACIONES_CABALLOS FOREIGN KEY (CODCABALLO)
        REFERENCES CABALLOS (CODCABALLO),
      CONSTRAINT FK_PARTICIPACIONESCARRERAS FOREIGN KEY (CODCARRERA)
        REFERENCES CARRERAS (CODCARRERA)
);

CREATE TABLE APUESTAS (
    DNICLIENTE VARCHAR2(10) NOT NULL,
    CODCABALLO VARCHAR2(4) NOT NULL,
    CODCARRERA VARCHAR2(4) NOT NULL,
    IMPORTE NUMBER(6) DEFAULT 300 NOT NULL,
    TANTOPORUNO NUMBER(6,2) CHECK(TANTOPORUNO > 1),
      CONSTRAINT PK_APUESTAS PRIMARY KEY (DNICLIENTE, CODCABALLO, CODCARRERA),
      CONSTRAINT FK_APUESTAS_CABALLOS FOREIGN KEY (CODCABALLO)
        REFERENCES CABALLOS (CODCABALLO),
      CONSTRAINT FK_APUESTAS_CARRERAS FOREIGN KEY (CODCARRERA)
        REFERENCES CARRERAS (CODCARRERA)
);

CREATE TABLE CLIENTES (
    DNICLIENTE VARCHAR2(10) NOT NULL,
    NOMBRE VARCHAR2(20),
    NACIONALIDAD VARCHAR2(20),
      CONSTRAINT PK_CLIENTES PRIMARY KEY (DNICLIENTE)
);

ALTER TABLE APUESTAS ADD (
    CONSTRAINT FK_APUESTAS_CLIENTE FOREIGN KEY (DNICLIENTE)
      REFERENCES CLIENTES (DNICLIENTE)
);
      